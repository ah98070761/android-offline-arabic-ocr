workflows:
  android-build:
    name: Android Build and Release
    git-cache: false # ğŸ’¡ Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø± Ù„Ø¥Ø¬Ø¨Ø§Ø± Codemagic Ø¹Ù„Ù‰ Ø§Ø³ØªÙ†Ø³Ø§Ø® Ù†Ø¸ÙŠÙ Ù„Ù„Ù…Ø³ØªÙˆØ¯Ø¹
    environment:
      vars:
        CM_JAVA_VERSION: 17
        CM_ANDROID_SDK_BUILD_TOOLS: 34.0.0
        CM_ANDROID_SDK_PLATFORM_TOOLS: 34.0.0
        CM_ANDROID_SDK_PLATFORM: 34
        GRADLE_USER_HOME: $CM_BUILD_DIR/.gradle 
      
    triggering:
      events:
        - push
        - pull_request
      branch_patterns:
        - pattern: master
          include: true
        - pattern: develop
          include: true
        - pattern: feature/.*
          include: true
    
    scripts:
      # ğŸ’¡ Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø·ÙˆØ© Ù„Ø¶Ù…Ø§Ù† Ù…Ø³Ø­ Ø£ÙŠ Ù…Ù„ÙØ§Øª Gradle Ù…Ø¤Ù‚ØªØ© Ù‚Ø¯ÙŠÙ…Ø©
      - name: Clear old Gradle cache for clean build
        script: |
          rm -rf $HOME/.gradle/caches/
          echo "âœ… ØªÙ… Ù…Ø³Ø­ Ø°Ø§ÙƒØ±Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª Ù„Ù€ Gradle Ø¨Ù†Ø¬Ø§Ø­."
      
      - name: Set up Android SDK
        script: |
          SDK_MANAGER="$ANDROID_SDK_ROOT/cmdline-tools/latest/bin/sdkmanager"
          echo "Setting up Android SDK Build Tools $CM_ANDROID_SDK_BUILD_TOOLS, Platform Tools $CM_ANDROID_SDK_PLATFORM_TOOLS, Platform $CM_ANDROID_SDK_PLATFORM"
          
          yes | $SDK_MANAGER "build-tools;$CM_ANDROID_SDK_BUILD_TOOLS" "platform-tools" "platforms;android-$CM_ANDROID_SDK_PLATFORM"
          yes | $SDK_MANAGER --licenses
      
      - name: Grant gradlew permission
        script: |
          # Ø³ÙŠØ¹Ù…Ù„ Ø§Ù„Ø¢Ù† Ù„Ø£Ù† Ø§Ù„Ù…Ù„Ù gradle-wrapper.jar Ù…ÙˆØ¬ÙˆØ¯
          chmod +x gradlew
          
      - name: Download and Set up Gradle Distribution
        script: |
          # Ø§Ù„Ù€ Wrapper Ø³ÙŠØ¬Ø¯ Ø§Ù„Ù€ JAR Ø§Ù„ØªÙ…Ù‡ÙŠØ¯ÙŠ ÙˆÙŠÙ‚ÙˆÙ… Ø¨ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù€ ZIP 9.1.0 ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
          ./gradlew dependencies --no-daemon
          
      - name: Run Android Lint and Build Android Release Bundle (Final Build Step)
        script: |
          ./gradlew lintRelease
          ./gradlew bundleRelease
          ./gradlew assembleRelease
          
      - name: List build outputs
        script: |
          ls -R app/build/outputs
          
    artifacts:
      - build/app/outputs/**/*.aab
      - build/app/outputs/**/*.apk
      - build/reports/**/*.html
      
    publishing:
      email:
        recipients:
          - your_email@example.com
        notify:
          success: true
          failure: false