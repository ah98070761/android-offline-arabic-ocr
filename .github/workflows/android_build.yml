name: Android CI Build and Release

on:
  # ØªØ´ØºÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø³ÙŠØ± Ø¹Ù…Ù„ Ø¹Ù†Ø¯ ÙƒÙ„ Ø¹Ù…Ù„ÙŠØ© Ø¯ÙØ¹ (push) Ø¹Ù„Ù‰ ÙØ±Ø¹ 'main' Ø£Ùˆ 'develop'
  push:
    branches:
      - main
      - master
      - develop
  # ØªØ´ØºÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø³ÙŠØ± Ø¹Ù…Ù„ Ø¹Ù†Ø¯ ÙƒÙ„ Ø·Ù„Ø¨ Ø³Ø­Ø¨ (pull request)
  pull_request:
    branches:
      - main
      - master
      - develop

jobs:
  build:
    # Ø³ÙŠØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨Ù†Ø§Ø¡ Ø¹Ù„Ù‰ Ø¨ÙŠØ¦Ø© Ø®Ø§Ø¯Ù… Ø£ÙˆØ¨ÙˆÙ†ØªÙˆ
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout Code
        # Ø§Ø³ØªÙ†Ø³Ø§Ø® Ø§Ù„ÙƒÙˆØ¯ Ù…Ù† Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹
        uses: actions/checkout@v4

      - name: Set up JDK 17
        # ØªØ­Ø¯ÙŠØ¯ Ø¨ÙŠØ¦Ø© Ø¬Ø§ÙØ§ (JDK) Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù€ jvmTarget = "17" ÙÙŠ Gradle)
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
          cache: 'gradle'

      - name: Grant Execute Permission for Gradle Wrapper
        # Ø¥Ø¹Ø·Ø§Ø¡ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ØªØ´ØºÙŠÙ„ Ù„Ù…Ù„Ù gradlew
        run: chmod +x gradlew

      - name: Clean Build Environment
        # Ø®Ø·ÙˆØ© Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ø¶Ù…Ø§Ù† ØªÙ†Ø¸ÙŠÙ Ø§Ù„ÙƒÙˆØ¯ ÙˆØ§Ù„Ø¨Ù†Ø§Ø¡
        run: ./gradlew clean --no-daemon

      - name: Run Android Lint (Static Code Analysis)
        # ØªØ´ØºÙŠÙ„ ÙØ­Øµ Lint Ù„Ø¶Ù…Ø§Ù† Ø¬ÙˆØ¯Ø© Ø§Ù„ÙƒÙˆØ¯ Ù‚Ø¨Ù„ Ø§Ù„Ø¨Ù†Ø§Ø¡
        run: ./gradlew lintRelease --no-daemon

      # ğŸ’¡ Ø®Ø·ÙˆØ© Ø¬Ø¯ÙŠØ¯Ø©: Ø¨Ù†Ø§Ø¡ Ø­Ø²Ù…Ø© Debug APK (Ù…ÙˆÙ‚Ø¹Ø© ÙˆÙ…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±)
      - name: Build Debug APK (Signed and Installable for Testing)
        run: ./gradlew assembleDebug --no-daemon

      - name: Build Release Bundle (AAB)
        # Ø¨Ù†Ø§Ø¡ Ø­Ø²Ù…Ø© AAB (ØºÙŠØ± Ù…ÙˆÙ‚Ø¹Ø© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±)
        run: ./gradlew bundleRelease --no-daemon
        
      - name: Build Release APK
        # Ø¨Ù†Ø§Ø¡ Ø­Ø²Ù…Ø© APK (ØºÙŠØ± Ù…ÙˆÙ‚Ø¹Ø© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±)
        run: ./gradlew assembleRelease --no-daemon

      # ğŸ’¡ Ø®Ø·ÙˆØ© Ø¬Ø¯ÙŠØ¯Ø©: Ø±ÙØ¹ Ø­Ø²Ù…Ø© Debug APK
      - name: Upload Debug APK Artifact
        uses: actions/upload-artifact@v4
        with:
          name: app-debug-apk-for-testing
          # Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ø­Ø²Ù…Ø© Debug APK Ø§Ù„Ù…ÙˆÙ‚Ø¹Ø©
          path: app/build/outputs/apk/debug/*.apk

      - name: Upload Release Artifacts (AAB)
        # Ø±ÙØ¹ Ù…Ù„Ù Ø­Ø²Ù…Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ (AAB) ÙƒÙ†Ø§ØªØ¬ Ù„Ù„Ø³ÙŠØ± Ø¹Ù…Ù„
        uses: actions/upload-artifact@v4
        with:
          name: app-release-bundle
          path: app/build/outputs/bundle/release/*.aab
          
      - name: Upload Release Artifacts (APK)
        # Ø±ÙØ¹ Ù…Ù„Ù APK ÙƒÙ†Ø§ØªØ¬ Ù„Ù„Ø³ÙŠØ± Ø¹Ù…Ù„
        uses: actions/upload-artifact@v4
        with:
          name: app-release-apk
          path: app/build/outputs/apk/release/*.apk